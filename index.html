<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heritage 3D Map</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Load PlayCanvas from official CDN -->
    <script src="https://code.playcanvas.com/playcanvas-stable.min.js"></script>
</head>
<body>
    <div id="app-container">
        <div id="model-viewer"></div>
        <div id="loading-status">Loading 3D viewer...</div>
    </div>

    <!-- Load Model Viewer script with fallback -->
    <script>
        function initViewer() {
            const loadingElement = document.getElementById('loading-status');
            
            // First fallback: Check if ModelViewer is already available
            if (window.pc && pc.ModelViewer) {
                createViewer();
                return;
            }

            // Second fallback: Try to load ModelViewer dynamically
            loadingElement.textContent = 'Loading 3D components...';
            const script = document.createElement('script');
            script.src = 'https://code.playcanvas.com/model-viewer/1.0.0/model-viewer.min.js';
            script.onload = createViewer;
            script.onerror = function() {
                loadingElement.textContent = 'Failed to load 3D viewer. Please refresh.';
                console.error('Failed to load ModelViewer plugin');
            };
            document.head.appendChild(script);
        }

        function createViewer() {
            const loadingElement = document.getElementById('loading-status');
            
            if (!window.pc || !pc.ModelViewer) {
                loadingElement.textContent = '3D viewer not available';
                console.error('PlayCanvas ModelViewer not found');
                return;
            }

            try {
                loadingElement.textContent = 'Initializing...';
                const viewer = new pc.ModelViewer(document.getElementById('model-viewer'), {
                    assetsPrefix: './models/',
                    orbitSensitivity: 1.0,
                    enableUi: true,
                    onError: function(err) {
                        loadingElement.textContent = 'Error: ' + err.message;
                    }
                });

                loadingElement.textContent = 'Loading model...';
                viewer.load('Kaplica_Zychlinskich.glb')
                    .then(() => {
                        loadingElement.style.display = 'none';
                        viewer.camera.orbitYaw = -30;
                        viewer.camera.orbitPitch = 75;
                        viewer.camera.distance = 10;
                    })
                    .catch(err => {
                        loadingElement.textContent = 'Model failed to load';
                        console.error('Model load error:', err);
                    });
            } catch (error) {
                loadingElement.textContent = 'Initialization failed';
                console.error('Viewer error:', error);
            }
        }

        // Start initialization when everything is ready
        if (document.readyState === 'complete') {
            initViewer();
        } else {
            window.addEventListener('load', initViewer);
        }
    </script>
</body>
</html>